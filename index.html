<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma-rtl.min.css">
    <link rel="stylesheet" href="/style.css" />
    <title>Hello, World!</title>
</head>

<body>
    <div id="nav">
        <h1 id="homelink">codeCoach</h1>
    </div>
    <div class="box">

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Primary -->
        <details role="list">
            <summary aria-haspopup="listbox" role="button">
                metrics
            </summary>
            <ul role="listbox">
                <li><a>Action</a></li>
                <li><a>Another action</a></li>
                <li><a>Something else here</a></li>
            </ul>
        </details>
        <label for="window-select">window</label>
        <select id="window-select">
            <option value="last week">last week</option>
            <option value="last month">last month</option>
            <option value="last three months">last three months</option>
            <option value="last year">last year</option>
        </select>

        <script>
            /* When the user clicks on the button, 
            toggle between hiding and showing the dropdown content */
            function myFunction() {
                document.getElementById("myDropdown").classList.toggle("show");
            }

            // Close the dropdown if the user clicks outside of it
            window.onclick = function (event) {
                if (!event.target.matches('.dropbtn')) {
                    var dropdowns = document.getElementsByClassName("dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
            }
        </script>

        <div>
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <script>
        const data = JSON.parse("{{ . }}")
        console.log(data)
        const ctx = document.getElementById('myChart');

        const dates = data.map(row => row.Date)
        console.log(dates)

        var reduced = [data[0]]
        const added = data.map(row => row.LinesAdded)

        const subtracted = data.map(row => row.LinesSubtracted)
        const cum = data.map(row => row.LinesAdded - row.LinesSubtracted)

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'lines added',
                        data: added,
                        borderWidth: 1
                    },
                    {
                        label: 'lines subtracted',
                        data: subtracted,
                        borderWidth: 1
                    },
                    {
                        label: 'cumulative',
                        data: cum,
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
    </div>
</body>

</html>